<!DOCTYPE html>
<html lang="en">
<head>
  	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta charset="utf-8">
	<title>Sodocoo' foo'</title>
	<link rel="stylesheet" href="main.css" type="text/css" media="screen" title="no title" >
	<script type="text/javascript" src="functions.js"></script>
	<script type="text/javascript" src="sodoku.js"></script>
	<script type="text/javascript">
		
		/** Create sodoku problem **/
		var mySodoku = new Sodoku("mySodoku", 81);
		// *************************** //
		window.onload = function() {
			
			// Create new puzzle (2-lines 20chars)
			//mySodoku.newPuzzle(2);
			mySodoku.testPuzzle();
			document.getElementById('possibles-checkbox').checked = true;
			
			//Sodoku edit delegation (MUST BE FOR CONTAINER BECAUSE SODO GETS REMADE IN HTML PRINTING)
			var sodo = document.getElementById('game');
			
			sodo.onclick = function(e) {
				var t = getTarget(e);
				var x ;
				console.log(t.className);
				//mySodoku.refreshDisplay();

				if(t.className === 'tiny' || t.className === 'entered-value' ){
					t = t.parentNode;
				}
				if(t.className === 'valid-possible'){
					t = t.parentNode;
					t = t.parentNode;
				}
				if(t.className === 'small') {
					x = t.id.substr(6);
					var obj = document.getElementById(t.id);
					var txt = '<input type="text" id="edit-txtbox" value="" class="edit-txt" onblur="commit();"> ';
					obj.innerHTML = txt+x;
					document.getElementById('edit-txtbox').focus();
				}
				
			};


			// sodo.onmouseover = function(e){
			// 	var t = getTarget(e);
			// 	if(t.className === 'small' ){
			// 		cell = t.id.substr(6);
			// 		mySodoku.highlightCells( cell );
			// 	}
			// };

			/** Toggling Viewing of Possible Values **/
			var possibles = document.getElementById('possibles-checkbox');
			possibles.onchange = function(e){
				var t = getTarget(e);
				if(t.checked){
					mySodoku.togglePossibles(true);
				}else{
					mySodoku.togglePossibles(false);
				}
			};

		};

		var commit = function(){

			// Find the textbox and parent
			var txtbox = document.getElementById('edit-txtbox');
			var parent = txtbox.parentNode;
			
			//Grab the text value from the textbox - 
			var value = txtbox.value;

			//Decide where it goes
			var cell = parent.id.substr(6);
			
			// NO VALUE - USER CANCELLING EVENT
			if(!value){
				//Remove value if there is one.
				if( mySodoku.solveBoard[cell] ){
					mySodoku.solveBoard[cell] = '';
				}

			}else if( mySodoku.check(cell, value) === true ){
				console.log('passed-check_'+cell+'_'+value);
				mySodoku.solveBoard[cell] = value;
			}else{
				//Show error
				alert('That value is invalid. Try again.');
			}
			mySodoku.refreshDisplay();
			return false;
		};




	</script>
</head>
<body>
	<div id="container">
		
		<div id="controls">
			
			<fieldset id="puzzle-controls">
				<h3>New Puzzle</h3>
				<input type="button" onClick="mySodoku.newPuzzle(1);" Value="Generate New (1)"><br>
				<input type="button" onClick="mySodoku.newPuzzle(2);" Value="Generate New (2)"><br>
				<input type="button" onClick="mySodoku.testPuzzle();" Value="Test Puzzle">				
			</fieldset>

			<fieldset id="view-controls">
				<h3>View</h3>
				<label>Possible Values</label><input id="possibles-checkbox" type="checkbox" value="1" checked="" ><br>
				<!-- <input type="button" onClick="mySodoku.showSolution();" Value="Solv" >
				<input type="button" onClick="mySodoku.display();" Value="Game" > -->
			</fieldset>

			<fieldset id="solving-controls">	
				<h3>Editing Puzzle</h3>
				<input type="button" onClick="mySodoku.startStepSolver();" Value="Manually Input Puzzle">
				<input type="button" onClick="mySodoku.fillSinglePossibles();" Value="Single Possible Move">	
			</fieldset>

			<fieldset>
				<h3>Brute Force Algo</h3>
				<input type="button" onClick="mySodoku.solve();" Value="FAST Solver - can freeze">
				<input type="button" onClick="mySodoku.startSolver();" Value="STEP Solver - Shows progress">	
				<input type="button" onClick="mySodoku.stopTimer();" Value="STOP Solvers">	
			</fieldset>
			
			<fieldset id="debug">
				<h3>Debug</h3>
				<label for="moves" class="small-label">Penciled Values</label>
				<input type="text" id="numofmoves" disabled>
				<input type="button" onclick="mySodoku.clear();" value="Clear Board">
				<input type="button" onclick="mySodoku.edit();" value="Edit Board">
				<!-- <input type="button" onClick="mySodoku.showCells();" Value="Cells"> -->
			</fieldset>
			</form>
		</div>
		<br style="clear:both;">
		<div id="game">
		</div>
		
	</div>	
</body>
</html>
