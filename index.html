<!DOCTYPE html>
<html lang="en">
<head>
  	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta charset="utf-8">
	<title>Sudocoo' foo'</title>
	<link rel="stylesheet" href="main.css" type="text/css" media="screen" title="no title" >
	<script type="text/javascript" src="functions.js"></script>
	<script type="text/javascript" src="sudoku.js"></script>
	<script type="text/javascript">
		
		var mysudoku;
		// *************************** //
		window.onload = function() {
			
			/** Create sudoku object **/
			mysudoku = new Sudoku("mysudoku", 81, 'game');
			
			mysudoku.testPuzzle(); //Default to a test puzzle

			/** Edit Puzzle Delegation **/
			var sodo = document.getElementById('game');
			sodo.onclick = function(e) {
				var t = getTarget(e);
				var x;
				//mysudoku.refreshDisplay();

				// Iterate down to our 'value' node
				if(t.className === 'tiny' || t.className === 'entered-value' ){

					while (t.nextSibling) {
    					t = t.nextSibling;
    					if (t.nodeName === 'DIV' && t.className === 'value') {
    						break;
    					}
    				}
				}
				if (t.className === 'value') {
					var obj = document.getElementById(t.id);
					var txt = '<input type="text" id="edit-txtbox" value="" class="edit-txt" onblur="commit();"> ';
					t.innerHTML = txt;
					document.getElementById('edit-txtbox').focus();
				}	
			};

			/** Edit Delegation's Callback **/
			var commit = function(){
				
				// Grab what class the sudoku funct is.
				var gameClass = document.getElementById('game').className;
				
				// Find the textbox and parent
				var txtbox = document.getElementById('edit-txtbox');
				var parent = txtbox.parentNode.parentNode;
				parent.className = parent.className.replace(/\bhighlight\b/,'');
				//parent.innerHTML=''; 
				
				// Grab the text value from the textbox - 
				var value = txtbox.value;

				// Decide where it goes
				var cell = parent.id.substr(6);
				
				// No value - User's cancelling event
				if(!value){

					if( gameClass === 'game-edit'){
						//Remove value if there is one.
						if( mysudoku.gameBoard[cell] ){
							mysudoku.gameBoard[cell] = '';
						}
					}else{
						//Remove value if there is one.
						if( mysudoku.solveBoard[cell] ){
							mysudoku.solveBoard[cell] = '';
						}
					}

				}else if( mysudoku.check(cell, value) === true ){
					
					if( gameClass === 'game-edit'){
						mysudoku.gameBoard[cell] = value;
					}else{
						mysudoku.solveBoard[cell] = value;
					}
				}else{
					//Show error
					alert('That value is invalid. Try again.');
				}
				mysudoku.refreshDisplay();
				return false;
			};
			
			
			/** Brute Force Algorithm Buttons **/
			document.getElementById('dumb-brute-toggle').onclick = function(){
				mysudoku.startSolver();
			};

			document.getElementById('dumb-brute-step').onclick = function(){
				mysudoku.solver();
			};

			document.getElementById('dumb-brute-recurse').onclick = function(){
				mysudoku.dumbBruteRecurse();
			};

			/** Edit Mode Toggle **/
			var edits = document.getElementById('edit-mode');
			edits.onchange = function(e){
				var t = getTarget(e);
				if (t.value == 'edit') {
					document.getElementById('game').className = 'game-edit';
				}else{
					mysudoku.toggleEditMode(false);
					document.getElementById('game').className = '';
				}
			};

			/** Possible Values Toggle **/
			var possibles = document.getElementById('possibles-checkbox');
			possibles.onchange = function(e){
				var t = getTarget(e);
				if(t.checked){
					mysudoku.togglePossibles(true);
				}else{
					mysudoku.togglePossibles(false);
				}
			};

		}; // end onload
	</script>

</head>
<body>
	<div id="container">
		
		<div id="controls">
			
			<fieldset id="puzzle-controls">
				<legend> New Puzzle </legend>
				<label>Premade:</label>
				<input type="button" onClick="mysudoku.testPuzzle(1);" Value="Easy">				
				<input type="button" onClick="mysudoku.testPuzzle(2);" Value="Evil">				
				<hr>
				<label>Generation: (not done)</label>
				<input type="button" onClick="mysudoku.generatePuzzle();" Value="Generate">				
				<input type="button" onClick="mysudoku.recurseGenerate();" Value="Recursive Generate">				
			</fieldset>

			<fieldset id="solving-controls">	
				<legend>User Mode</legend>
				<input type="button" onclick="mysudoku.empty();" value="Empty Board">
				<hr>
				<select id="edit-mode">
					<option value="solve" selected>solve mode</option>
					<option value="edit" >edit mode</option>
				</select>
				
			</fieldset>

			<fieldset>
				<legend>Dumb Brute Algo</legend>
				<span id="dumb-brute-status" class="status">Algo <strong>not</strong> currently running...</span>
				<input id="dumb-brute-toggle"  type="button" value="Start/Stop">
				<input id="dumb-brute-step" type="button" value="Step">
				<hr>
				<input id="dumb-brute-recurse" type="button" value="Recursive">
			</fieldset>

			<fieldset>
				<legend>Only Option Algo</legend>
				<input type="button" onClick="mysudoku.fillSinglePossibles();" Value="Run">	
				<br>Great when starting.
			</fieldset>

			<fieldset id="debug">
				<legend>Debug</legend>
				<label for="moves" class="small-label">Penciled:</label>
				<input type="text" id="numofmoves" disabled>
				<br>
				<label for="timer" class="small-label">Time (s):</label>
				<input type="text" id="txt-timer" disabled>
				<br>
				<label for="possibles-checkbox" class="small-label">Possible Values</label><input id="possibles-checkbox" type="checkbox" value="1" checked="" >
				
			</fieldset>
			</form>
		</div><!-- End of controls -->

		<br style="clear:both;">
		
		<div id="game">
			
		</div>
		
	</div>	
</body>
</html>
