<!DOCTYPE html>
<html lang="en">
<head>
  	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta charset="utf-8">
	<title>Sodocoo' foo'</title>
	<link rel="stylesheet" href="main.css" type="text/css" media="screen" title="no title" >
	<script type="text/javascript" src="functions.js"></script>
	<script type="text/javascript" src="sodoku.js"></script>
	<script type="text/javascript">
		
		/** Create sodoku problem **/
		var mySodoku = new Sodoku("mySodoku", 81);


		// *************************** //
		window.onload = function() {
			
			// Create new puzzle (2-lines 20chars)
			mySodoku.testPuzzle();
			document.getElementById('possibles-checkbox').checked = true;
			
			//Sodoku edit delegation (MUST BE FOR CONTAINER BECAUSE SODO GETS REMADE IN HTML PRINTING)
			var sodo = document.getElementById('game');
			
			sodo.onclick = function(e) {
				var t = getTarget(e);
				var x;
				console.log(t.className);
				//mySodoku.refreshDisplay();

				if(t.className === 'tiny' || t.className === 'entered-value' ){
					t = t.parentNode;
				}
				if(t.className === 'valid-possible'){
					t = t.parentNode;
					t = t.parentNode;
				}
				if(t.className === 'small') {
					x = t.id.substr(6);
					var obj = document.getElementById(t.id);
					var txt = '<input type="text" id="edit-txtbox" value="" class="edit-txt" onblur="commit();"> ';
					obj.innerHTML = txt+x;
					document.getElementById('edit-txtbox').focus();
				}
				
			};


			// sodo.onmouseover = function(e){
			// 	var t = getTarget(e);
			// 	if(t.className === 'small' ){
			// 		cell = t.id.substr(6);
			// 		mySodoku.highlightCells( cell );
			// 	}
			// };
			
			var edits = document.getElementById('edit-mode');
			edits.onchange = function(e){
				var t = getTarget(e);
				if(t.value == 'edit'){
					//mySodoku.toggleEditMode(true);
					document.getElementById('game').className = 'game-edit';

				}else{
					mySodoku.toggleEditMode(false);
					document.getElementById('game').className = '';
				}
			};

			/** Toggling Viewing of Possible Values **/
			var possibles = document.getElementById('possibles-checkbox');
			possibles.onchange = function(e){
				var t = getTarget(e);
				if(t.checked){
					mySodoku.togglePossibles(true);
				}else{
					mySodoku.togglePossibles(false);
				}
			};

		}; // end onload

		var commit = function(){
			
			var gameClass = document.getElementById('game').className;
			//alert(sodo.className);
				
			// Find the textbox and parent
			var txtbox = document.getElementById('edit-txtbox');
			var parent = txtbox.parentNode;
			
			//Grab the text value from the textbox - 
			var value = txtbox.value;

			//Decide where it goes
			var cell = parent.id.substr(6);
			
			// NO VALUE - USER CANCELLING EVENT
			if(!value){

				if( gameClass === 'game-edit'){
					//Remove value if there is one.
					if( mySodoku.gameBoard[cell] ){
						mySodoku.gameBoard[cell] = '';
					}
				}else{
					//Remove value if there is one.
					if( mySodoku.solveBoard[cell] ){
						mySodoku.solveBoard[cell] = '';
					}
				}

			}else if( mySodoku.check(cell, value) === true ){
				console.log('passed-check_'+cell+'_'+value);
				if( gameClass === 'game-edit'){
					mySodoku.gameBoard[cell] = value;
				}else{
					mySodoku.solveBoard[cell] = value;
				}
			}else{
				//Show error
				alert('That value is invalid. Try again.');
			}
			mySodoku.refreshDisplay();
			return false;
		};

		var newPuzzle = function(rows){

			var x = document.getElementById('new-puzzle-select').value;
			mySodoku.newPuzzle(x);
		};
	</script>

</head>
<body>
	<div id="container">
		
		<div id="controls">
			
			<fieldset id="puzzle-controls">
				<legend>New Puzzle</legend>
				<select id="new-puzzle-select">
					<option value="1">1</option>
					<option value="2">2</option>
					<option value="3" selected>3</option>
					<option value="4">4</option>
					<option value="5">5</option>
					<option value="6">6</option>
					<option value="7">7</option>
					<option value="8">8</option>
					<option value="9">9</option>
				</select>
				<input type="button" onClick="newPuzzle();" Value="Create"><br>
				
				<input type="button" onClick="mySodoku.testPuzzle();" Value="Pre #1">				
			</fieldset>

			<fieldset id="view-controls" style="display:none;">
				<legend>View</legend>
				<!-- <input type="button" onClick="mySodoku.showSolution();" Value="Solv" >
				<input type="button" onClick="mySodoku.display();" Value="Game" > -->
			</fieldset>

			<fieldset id="solving-controls">	
				<legend>Edit Mode</legend>
				<input type="button" onclick="mySodoku.empty();" value="Empty Board">
				<hr>
				<select id="edit-mode">
					<option value="solve" selected>solve mode</option>
					<option value="edit" >edit mode</option>
				</select>
				
			</fieldset>

			<fieldset>
				<legend>Dumb Brute Algo</legend>
				<input type="button" onClick="mySodoku.startSolver();" Value="Start/Stop">
				<br> I'll try anything!
			</fieldset>
			
			<fieldset>
				<legend>Smart Brute Algo</legend>
				<input type="button" onClick="mySodoku.startSolver();" Value="Start/Stop">
				<br> I'll try anything!
				<br>But I see when my moves suck.
			</fieldset>
			<fieldset>
				<legend>One Option Left Algo</legend>
				<input type="button" onClick="mySodoku.fillSinglePossibles();" Value="Run">	
				<br>Great when starting.
			</fieldset>
			<fieldset id="debug">
				<legend>Debug</legend>
				<label for="moves" class="small-label">Moves: </label>
				<input type="text" id="numofmoves" disabled>
				<br>
				<label for="possibles-checkbox" class="small-label">Possible Values</label><input id="possibles-checkbox" type="checkbox" value="1" checked="" ><br>

				<!-- <input type="button" onclick="mySodoku.empty();" value="Empty Board"> -->
				<!-- <input type="button" onClick="mySodoku.showCells();" Value="Cells"> -->
			</fieldset>
			</form>
		</div><!-- End of controls -->

		<br style="clear:both;">
		
		<div id="game">
		</div>
		
	</div>	
</body>
</html>
